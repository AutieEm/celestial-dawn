<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="theme-color" content="#F4F3F0">
<title>Celestial Dawn</title>
<link rel="manifest" href="./manifest.json">
<link rel="apple-touch-icon" href="./icon-192.png">
<link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{background:#F4F3F0;overflow-x:hidden;-webkit-tap-highlight-color:transparent}
@keyframes expandIn{from{opacity:0;max-height:0}to{opacity:1;max-height:600px}}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const {useState, useEffect} = React;

const DEFAULT_WORK_ARRIVAL = "8:00";
const DEFAULT_COMMUTE = 30;

function parseTime(str) {
  const [h, m] = str.split(":").map(Number);
  return h * 60 + m;
}
function fmtMin(totalMin) {
  let m = ((totalMin % 1440) + 1440) % 1440;
  const h = Math.floor(m / 60);
  const min = m % 60;
  const ap = h >= 12 ? "PM" : "AM";
  const h12 = h === 0 ? 12 : h > 12 ? h - 12 : h;
  return `${h12}:${min.toString().padStart(2, "0")} ${ap}`;
}
function computeTimes(arrival, commute) {
  const a = parseTime(arrival);
  const gg = a - commute - 15;
  const gr = gg - 30;
  const f = gr - 30;
  const mo = f - 45;
  return {
    "early-am": { start: null, end: mo },
    morning: { start: mo, end: f },
    food: { start: f, end: gr },
    "get-ready": { start: gr, end: gg },
    "gather-go": { start: gg, end: a },
  };
}

const MORNING = [
  { id: "early-am", name: "Early AM", purpose: "Determine that you are safe and ideas are secured.",
    color: "#5A6ABF", actions: ["Capture", "Wander", "Comforting Music"], showActions: true },
  { id: "morning", name: "Morning", purpose: "Feel better about eventually facing the day.",
    color: "#7059A8", actions: ["Scrape Tongue", "Make Bed", "Heat Lamp", "Bright Light", "PT Exercise", "Water Bottle + Supps"],
    showActions: true },
  { id: "food", name: "Food", purpose: "Ensure that your body gets nourishment today.",
    color: "#3D9E7C", actions: ["Soapy Water", "Tea", "Heat Thermos", "Heat Lunch", "Assemble + Clean", "Eat Breakfast + Tea"],
    showActions: true },
  { id: "get-ready", name: "Get Ready", purpose: "Become the person who is ready to go to work.",
    color: "#C06080", actions: [], showActions: false },
  { id: "gather-go", name: "Gather & Go", purpose: "Collect all needed equipment and report to transport station.",
    color: "#D06030", actions: ["Gather Bag", "Lunch + Water", "Keys, Wallet, Phone", "Coat \u00B7 Car Prep \u00B7 Drive"],
    showActions: true },
];

const EVENING = [
  { id: "eve-arrive", name: "Arrive & Put Away", purpose: "Transition from the outside world. Offload the day and reclaim your space.",
    color: "#B08040", actions: ["Put Away Purchases", "Unpack Work Bag", "Unpack Lunch Bag", "Thermos to Soak", "Process Mail", "Capture + Wander"],
    showActions: true },
  { id: "eve-food", name: "Food", purpose: "Nourish yourself at the end of a long watch.",
    color: "#5E9A50", actions: ["Soapy Water Bin", "Dinner", "Clear Dishes"],
    showActions: true },
  { id: "eve-clean", name: "Clean & Close Out", purpose: "Complete the day's cycle. Secure the ship for the night watch.",
    color: "#7A70A0", actions: ["Do Dishes", "Wipe Counters + Sweep", "Done List Activity", "Capture + Wander", "Am I done? Am I safe? Can I rest?"],
    showActions: true },
  { id: "eve-selfcare", name: "Self Care & Pleasure", purpose: "You have done enough. Release the day and let yourself rest.",
    color: "#506090", actions: ["Oil Body + PJs", "Teeth + Floss + Sinks Rinse", "YT + Quiet Music", "Bed & Let Go"],
    showActions: true },
];

const CREW_MORNING = {
  "early-am": "Systems are quiet, Captain. Take your time.",
  morning: "Dawn simulation initiated. At your pace, Captain.",
  food: "Crew readiness improves with proper provisioning.",
  "get-ready": "The ship will be ready when you are.",
  "gather-go": "All systems green! Launch window is open!",
};
const CREW_EVENING = {
  "eve-arrive": "Welcome back to the Dawn. Stand down at your pace.",
  "eve-food": "The crew has earned a good meal, Captain.",
  "eve-clean": "Securing systems for night cycle.",
  "eve-selfcare": "The bridge is secure. Rest well, Captain.",
};

function App() {
  const [mode, setMode] = useState("morning");
  const [active, setActive] = useState(null);
  const [now, setNow] = useState(new Date());
  const [showEarly, setShowEarly] = useState(false);
  const [custArr, setCustArr] = useState("");
  const [custCom, setCustCom] = useState("");
  const [appArr, setAppArr] = useState(DEFAULT_WORK_ARRIVAL);
  const [appCom, setAppCom] = useState(DEFAULT_COMMUTE);

  const times = computeTimes(appArr, appCom);
  const containers = mode === "morning" ? MORNING : EVENING;
  const crew = mode === "morning" ? CREW_MORNING : CREW_EVENING;

  useEffect(() => { const t = setInterval(() => setNow(new Date()), 60000); return () => clearInterval(t); }, []);
  useEffect(() => { setActive(null); setShowEarly(false); }, [mode]);

  const isCustom = appArr !== DEFAULT_WORK_ARRIVAL || appCom !== DEFAULT_COMMUTE;
  const applyEarly = () => { setAppArr(custArr || DEFAULT_WORK_ARRIVAL); setAppCom(parseInt(custCom) || DEFAULT_COMMUTE); setShowEarly(false); };
  const resetTimes = () => { setAppArr(DEFAULT_WORK_ARRIVAL); setAppCom(DEFAULT_COMMUTE); setCustArr(""); setCustCom(""); setShowEarly(false); };

  const fmtClock = (d) => d.toLocaleTimeString("en-US", { hour: "numeric", minute: "2-digit" });
  const fmtDate = (d) => d.toLocaleDateString("en-US", { weekday: "long", month: "long", day: "numeric" });

  const getTime = (id) => {
    const t = times[id];
    if (!t) return "";
    return `${t.start != null ? fmtMin(t.start) : "Wake"} \u2013 ${t.end != null ? fmtMin(t.end) : ""}`;
  };

  const S = {
    page: { minHeight: "100vh", background: "#F4F3F0", fontFamily: "'Nunito Sans', -apple-system, sans-serif", maxWidth: 480, margin: "0 auto" },
    header: { display: "flex", justifyContent: "space-between", alignItems: "flex-end", padding: "20px 20px 12px" },
    date: { fontSize: 18, fontWeight: 700, color: "#2A2D3E", lineHeight: 1.3 },
    time: { fontSize: 14, fontWeight: 400, color: "#8A8D9E", marginTop: 2 },
    headerRight: { textAlign: "right" },
    shipLabel: { fontSize: 13, fontWeight: 600, color: "#B8A070", letterSpacing: 0.5 },
    toggleWrap: { display: "flex", gap: 0, padding: "0 20px 12px" },
    togBtn: { flex: 1, padding: "10px 0", border: "2px solid #E0DDD8", background: "#FFFFFF", color: "#8A8D9E", fontSize: 15, fontWeight: 600, fontFamily: "'Nunito Sans', sans-serif", cursor: "pointer", transition: "all 0.2s ease", borderRadius: 0 },
    togActive: { background: "#2A2D3E", color: "#FFFFFF", borderColor: "#2A2D3E" },
    togEveActive: { background: "#3E3A50", color: "#FFFFFF", borderColor: "#3E3A50" },
    earlyWrap: { padding: "0 20px 8px" },
    earlyBtn: { width: "100%", padding: "8px", background: "transparent", border: "1px dashed #CCC8C0", borderRadius: 6, color: "#8A8D9E", fontSize: 13, fontFamily: "'Nunito Sans', sans-serif", cursor: "pointer" },
    earlyBadge: { display: "flex", alignItems: "center", gap: 8, padding: "8px 12px", background: "#EDE8DF", borderRadius: 6 },
    earlyBadgeText: { flex: 1, fontSize: 13, fontWeight: 600, color: "#6A6050" },
    earlyEditBtn: { background: "transparent", border: "1px solid #C8C0B0", borderRadius: 4, padding: "3px 10px", fontSize: 12, color: "#6A6050", fontFamily: "'Nunito Sans', sans-serif", cursor: "pointer" },
    earlyResetBtn: { background: "transparent", border: "1px solid #D8D4CC", borderRadius: 4, padding: "3px 10px", fontSize: 12, color: "#AAA498", fontFamily: "'Nunito Sans', sans-serif", cursor: "pointer" },
    earlyPanel: { background: "#FFFFFF", border: "1px solid #E0DDD8", borderRadius: 8, padding: 16 },
    earlyRow: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 12 },
    earlyLabel: { fontSize: 15, fontWeight: 600, color: "#2A2D3E" },
    earlyInput: { border: "1px solid #E0DDD8", borderRadius: 4, padding: "6px 10px", fontSize: 15, fontFamily: "'Nunito Sans', sans-serif", width: 130, textAlign: "center", color: "#2A2D3E" },
    earlyNumInput: { border: "1px solid #E0DDD8", borderRadius: 4, padding: "6px 10px", fontSize: 15, fontFamily: "'Nunito Sans', sans-serif", width: 80, textAlign: "center", color: "#2A2D3E" },
    earlyBtns: { display: "flex", gap: 10 },
    earlyApply: { flex: 1, padding: "10px", background: "#2A2D3E", border: "none", borderRadius: 6, color: "#FFFFFF", fontSize: 15, fontWeight: 700, fontFamily: "'Nunito Sans', sans-serif", cursor: "pointer" },
    earlyCancel: { flex: 1, padding: "10px", background: "transparent", border: "1px solid #E0DDD8", borderRadius: 6, color: "#8A8D9E", fontSize: 15, fontFamily: "'Nunito Sans', sans-serif", cursor: "pointer" },
    list: { display: "flex", flexDirection: "column", gap: 6, padding: "0 12px" },
    card: { background: "#FAFAF8", borderRadius: 10, borderLeft: "4px solid transparent", transition: "all 0.2s ease", overflow: "hidden" },
    cardHeader: { display: "flex", alignItems: "center", justifyContent: "space-between", width: "100%", padding: "14px 16px 14px 12px", background: "transparent", border: "none", cursor: "pointer", outline: "none", textAlign: "left", fontFamily: "'Nunito Sans', sans-serif" },
    cardLeft: { display: "flex", alignItems: "center", gap: 12 },
    dot: { width: 12, height: 12, borderRadius: "50%", flexShrink: 0 },
    cardName: { fontSize: 17, fontWeight: 700, transition: "color 0.2s ease" },
    cardTime: { fontSize: 13, color: "#AAA8A0", fontWeight: 400, marginTop: 1 },
    chevron: { fontSize: 18, color: "#C0BDB8", transition: "transform 0.2s ease", flexShrink: 0 },
    expanded: { padding: "0 16px 16px 28px", animation: "expandIn 0.25s ease-out" },
    purpose: { fontSize: 16, fontWeight: 400, color: "#4A4D5E", lineHeight: 1.5, marginBottom: 12, fontStyle: "italic" },
    actions: { display: "flex", flexDirection: "column", gap: 6, marginBottom: 12 },
    actionRow: { display: "flex", alignItems: "center", gap: 10 },
    actionDot: { width: 7, height: 7, borderRadius: "50%", flexShrink: 0 },
    actionText: { fontSize: 15, color: "#4A4D5E", fontWeight: 400 },
    crew: { padding: "8px 12px", background: "#F0EDE8", borderRadius: 6, marginBottom: 8 },
    crewText: { fontSize: 13, color: "#8A8878", fontStyle: "italic", lineHeight: 1.4 },
    timeRange: { fontSize: 13, color: "#AAA8A0", fontWeight: 600, textAlign: "center", marginTop: 4 },
    bottomBuffer: { height: 80, flexShrink: 0 },
  };

  return (
    <div style={S.page}>
      <header style={S.header}>
        <div>
          <div style={S.date}>{fmtDate(now)}</div>
          <div style={S.time}>{fmtClock(now)}</div>
        </div>
        <div style={S.headerRight}>
          <div style={S.shipLabel}>{"\u2726"} Celestial Dawn</div>
        </div>
      </header>

      <div style={S.toggleWrap}>
        <button onClick={()=>setMode("morning")} style={{...S.togBtn,...(mode==="morning"?S.togActive:{})}}>Morning</button>
        <button onClick={()=>setMode("evening")} style={{...S.togBtn,...(mode==="evening"?S.togEveActive:{})}}>Evening</button>
      </div>

      {mode==="morning"&&(
        <div style={S.earlyWrap}>
          {!showEarly&&!isCustom&&(
            <button onClick={()=>setShowEarly(true)} style={S.earlyBtn}>{"\u2699"} Early arrival</button>
          )}
          {isCustom&&!showEarly&&(
            <div style={S.earlyBadge}>
              <span style={S.earlyBadgeText}>Arrive {fmtMin(parseTime(appArr))} {"\u00B7"} {appCom} min commute</span>
              <button onClick={()=>setShowEarly(true)} style={S.earlyEditBtn}>Edit</button>
              <button onClick={resetTimes} style={S.earlyResetBtn}>Reset</button>
            </div>
          )}
          {showEarly&&(
            <div style={S.earlyPanel}>
              <div style={S.earlyRow}>
                <label style={S.earlyLabel}>Arrive by</label>
                <input type="time" value={custArr||DEFAULT_WORK_ARRIVAL} onChange={e=>setCustArr(e.target.value)} style={S.earlyInput}/>
              </div>
              <div style={S.earlyRow}>
                <label style={S.earlyLabel}>Commute (min)</label>
                <input type="number" value={custCom||DEFAULT_COMMUTE} onChange={e=>setCustCom(e.target.value)} min={5} max={120} style={S.earlyNumInput}/>
              </div>
              <div style={S.earlyBtns}>
                <button onClick={applyEarly} style={S.earlyApply}>Set</button>
                <button onClick={()=>setShowEarly(false)} style={S.earlyCancel}>Cancel</button>
              </div>
            </div>
          )}
        </div>
      )}

      <div style={S.list}>
        {containers.map(c=>{
          const isActive=active===c.id;
          const crewMsg=crew[c.id];
          return(
            <div key={c.id} style={{...S.card,borderLeftColor:c.color,...(isActive?{background:"#FFFFFF",boxShadow:`0 2px 12px rgba(0,0,0,0.08), inset 4px 0 0 ${c.color}`}:{})}}>
              <button onClick={()=>setActive(isActive?null:c.id)} style={S.cardHeader}>
                <div style={S.cardLeft}>
                  <div style={{...S.dot,background:c.color}}/>
                  <div>
                    <div style={{...S.cardName,color:isActive?c.color:"#2A2D3E"}}>{c.name}</div>
                    {mode==="morning"&&times[c.id]&&(
                      <div style={S.cardTime}>{times[c.id].start!=null?fmtMin(times[c.id].start):"Wake"}</div>
                    )}
                  </div>
                </div>
                <div style={{...S.chevron,transform:isActive?"rotate(180deg)":"rotate(0deg)"}}>{"\u25BE"}</div>
              </button>
              {isActive&&(
                <div style={S.expanded}>
                  <div style={S.purpose}>{c.purpose}</div>
                  {c.showActions&&c.actions.length>0&&(
                    <div style={S.actions}>
                      {c.actions.map((a,i)=>(
                        <div key={i} style={S.actionRow}>
                          <div style={{...S.actionDot,background:c.color}}/>
                          <span style={S.actionText}>{a}</span>
                        </div>
                      ))}
                    </div>
                  )}
                  {crewMsg&&(
                    <div style={S.crew}>
                      <span style={S.crewText}>"{crewMsg}"</span>
                    </div>
                  )}
                  {mode==="morning"&&times[c.id]&&(
                    <div style={S.timeRange}>{getTime(c.id)}</div>
                  )}
                </div>
              )}
            </div>
          );
        })}
      </div>
      <div style={S.bottomBuffer}/>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
<script>
if('serviceWorker' in navigator){navigator.serviceWorker.register('./sw.js').catch(()=>{});}
</script>
</body>
</html>
